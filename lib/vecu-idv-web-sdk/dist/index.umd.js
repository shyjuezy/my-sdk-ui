!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).VecuIDV={})}(this,function(e){"use strict";class t{constructor(){this.events=new Map}on(e,t){this.events.has(e)||this.events.set(e,new Set),this.events.get(e).add(t)}off(e,t){const i=this.events.get(e);i&&(i.delete(t),0===i.size&&this.events.delete(e))}emit(e,t){const i=this.events.get(e);if(i){const s={type:e,timestamp:new Date,data:t};i.forEach(e=>{try{e(s)}catch(e){}})}"*"!==e&&this.emit("*",{type:e,data:t})}once(e,t){const i=s=>{this.off(e,i),t(s)};this.on(e,i)}removeAllListeners(e){e?this.events.delete(e):this.events.clear()}listenerCount(e){const t=this.events.get(e);return t?t.size:0}eventNames(){return Array.from(this.events.keys())}}class i{constructor(e){this.config={...e,baseUrl:e.baseUrl.replace(/\/$/,"")},this.baseHeaders={"Content-Type":"application/json","X-API-Key":e.apiKey,"X-SDK-Version":"1.0.0","X-SDK-Platform":"web"}}async createVerificationSession(e){return this.request("/verification/sessions",{method:"POST",body:JSON.stringify(e)})}async getVerificationSession(e){return this.request(`/verification/sessions/${e}`)}async updateVerificationSession(e,t){return this.request(`/verification/sessions/${e}`,{method:"PATCH",body:JSON.stringify(t)})}async getVerificationResult(e){return this.request(`/verification/sessions/${e}/result`)}async cancelVerification(e){return this.request(`/verification/sessions/${e}/cancel`,{method:"POST"})}async request(e,t={}){const{retries:i=this.config.maxRetries,retryDelay:s=this.config.retryDelay,...r}=t,o=`${this.config.baseUrl}${e}`,n=new AbortController,a=setTimeout(()=>n.abort(),this.config.timeout);try{const e=await this.fetchWithRetry(o,{...r,headers:{...this.baseHeaders,...r.headers},signal:n.signal},i,s);clearTimeout(a);const t=e.headers.get("content-type"),c=t?.includes("application/json");if(!e.ok){const t=c?await e.json():{message:await e.text()};return{success:!1,error:{code:t.code||`HTTP_${e.status}`,message:t.message||`Request failed with status ${e.status}`,details:t.details}}}return{success:!0,data:c?await e.json():null}}catch(e){return clearTimeout(a),e instanceof Error?"AbortError"===e.name?{success:!1,error:{code:"TIMEOUT",message:`Request timed out after ${this.config.timeout}ms`}}:{success:!1,error:{code:"NETWORK_ERROR",message:e.message,details:e}}:{success:!1,error:{code:"UNKNOWN_ERROR",message:"An unknown error occurred",details:e}}}}async fetchWithRetry(e,t,i,s){let r=null;for(let o=0;o<=i;o++){try{const s=await fetch(e,t);if(s.status>=400&&s.status<500)return s;if(s.ok||o===i)return s;r=new Error(`HTTP ${s.status}: ${s.statusText}`)}catch(e){if(r=e,"AbortError"===r.name)throw r}if(o<i){const e=s*Math.pow(2,o)+1e3*Math.random();await new Promise(t=>setTimeout(t,e))}}throw r||new Error("Request failed after retries")}updateConfig(e){this.config={...this.config,...e},e.apiKey&&(this.baseHeaders={...this.baseHeaders,"X-API-Key":e.apiKey})}}class s{constructor(){this.providers=new Map}register(e){if(!e.name)throw new Error("Provider must have a name");if(this.providers.has(e.name))throw new Error(`Provider '${e.name}' is already registered`);this.providers.set(e.name,e)}unregister(e){const t=this.providers.get(e);t&&(t.destroy(),this.providers.delete(e))}get(e){return this.providers.get(e)}getAll(){return Array.from(this.providers.values())}has(e){return this.providers.has(e)}clear(){this.providers.forEach(e=>{e.destroy()}),this.providers.clear()}getByFeature(e){return this.getAll().filter(t=>t.supportedFeatures.includes(e))}getLoadedProviders(){return this.getAll().filter(e=>e.isLoaded)}}class r{constructor(e){this.registry=e,this.loadingPromises=new Map}async load(e){const t=this.loadingPromises.get(e);if(t)return t;const i=this.registry.get(e);if(i&&i.isLoaded)return i;const s=this.loadProvider(e);this.loadingPromises.set(e,s);try{const t=await s;return this.loadingPromises.delete(e),t}catch(t){throw this.loadingPromises.delete(e),t}}async loadProvider(e){const t=await this.importProvider(e),i=t.default||t[`${this.capitalize(e)}Provider`];if(!i)throw new Error(`Provider class not found for ${e}`);const s=new i;return await s.loadSDK(),this.registry.has(e)||this.registry.register(s),s}async importProvider(e){switch(e){case"socure":return Promise.resolve().then(function(){return T});case"incode":case"jumio":case"onfido":case"veriff":throw new Error(`Provider ${e} is not yet implemented`);default:throw new Error(`Unknown provider: ${e}`)}}isLoaded(e){const t=this.registry.get(e);return!!t&&t.isLoaded}getLoadedProviders(){return this.registry.getLoadedProviders().map(e=>e.name)}capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}}class o{constructor(e="info",t=!0,i="[VecuIDV]"){this.logLevels={error:0,warn:1,info:2,debug:3},this.level=e,this.enabled=t,this.prefix=i}error(e,...t){this.log("error",e,...t)}warn(e,...t){this.log("warn",e,...t)}info(e,...t){this.log("info",e,...t)}debug(e,...t){this.log("debug",e,...t)}log(e,t,...i){if(!this.enabled||!this.shouldLog(e))return;const s=(new Date).toISOString();this.prefix,e.toUpperCase()}shouldLog(e){return this.logLevels[e]<=this.logLevels[this.level]}setLevel(e){this.level=e}setEnabled(e){this.enabled=e}createChildLogger(e){return new o(this.level,this.enabled,`${this.prefix} ${e}`)}}class n extends Error{constructor(e,t,i,s){super(t),this.name="VecuError",this.code=e,this.provider=i,this.details=s,Error.captureStackTrace&&Error.captureStackTrace(this,n)}toJSON(){return{name:this.name,code:this.code,message:this.message,provider:this.provider,details:this.details,stack:this.stack}}}class a extends n{constructor(e,t){super("VALIDATION_ERROR",e,void 0,t),this.name="ValidationError"}}class c extends n{constructor(e,t,i){super("PROVIDER_ERROR",t,e,i),this.name="ProviderError"}}class d extends n{constructor(e,t){super("TIMEOUT_ERROR",e,void 0,{timeout:t}),this.name="TimeoutError"}}function l(e){if(!e)throw new a("Configuration object is required");if(!e.apiKey||"string"!=typeof e.apiKey)throw new a("API key is required and must be a string");if(e.apiKey.length<10)throw new a("API key appears to be invalid (too short)");if(e.apiUrl&&"string"!=typeof e.apiUrl)throw new a("API URL must be a string");if(e.apiUrl&&!function(e){try{const t=new URL(e);return["http:","https:"].includes(t.protocol)}catch{return!1}}(e.apiUrl))throw new a("API URL is not a valid URL");if(e.environment&&!["development","staging","production"].includes(e.environment))throw new a("Environment must be one of: development, staging, production");if(e.theme&&!["light","dark","auto"].includes(e.theme))throw new a("Theme must be one of: light, dark, auto");if(e.language&&"string"!=typeof e.language)throw new a("Language must be a string (ISO language code)");if(void 0!==e.timeout&&("number"!=typeof e.timeout||e.timeout<=0))throw new a("Timeout must be a positive number");if(void 0!==e.maxRetries&&("number"!=typeof e.maxRetries||e.maxRetries<0))throw new a("Max retries must be a non-negative number");if(e.logLevel&&!["error","warn","info","debug"].includes(e.logLevel))throw new a("Log level must be one of: error, warn, info, debug")}function u(e){if(!e)throw new a("Verification options are required");if(!e.user||"object"!=typeof e.user)throw new a("User data is required and must be an object");if(function(e){if(e.email&&(t=e.email,!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)))throw new a("Invalid email address format");var t;if(e.phone&&(i=e.phone,!(/^\+?[\d\s\-().]+$/.test(i)&&i.replace(/\D/g,"").length>=7)))throw new a("Invalid phone number format");var i;if(e.dateOfBirth&&!function(e){if(!/^\d{4}-\d{2}-\d{2}$/.test(e))return!1;const t=new Date(e);return t instanceof Date&&!isNaN(t.getTime())}(e.dateOfBirth))throw new a("Invalid date of birth format (use YYYY-MM-DD)");if(e.firstName&&"string"!=typeof e.firstName)throw new a("First name must be a string");if(e.lastName&&"string"!=typeof e.lastName)throw new a("Last name must be a string");if(e.address){if("object"!=typeof e.address)throw new a("Address must be an object");!function(e){const t=["street","city","state","postalCode","country"];for(const[i,s]of Object.entries(e))if(t.includes(i)&&void 0!==s&&"string"!=typeof s)throw new a(`Address ${i} must be a string`);if(e.postalCode&&"string"==typeof e.postalCode&&(i=e.postalCode,!(/^[\dA-Z\s-]+$/i.test(i)&&i.length>=3)))throw new a("Invalid postal code format");var i}(e.address)}}(e.user),e.container)if("string"==typeof e.container){if(!document.querySelector(e.container))throw new a(`Container element '${e.container}' not found`)}else if(!(e.container instanceof HTMLElement))throw new a("Container must be a CSS selector string or HTMLElement");if(e.mode&&!["modal","embedded"].includes(e.mode))throw new a('Mode must be either "modal" or "embedded"');if(e.preferredProvider&&"string"!=typeof e.preferredProvider)throw new a("Preferred provider must be a string");if(e.excludeProviders){if(!Array.isArray(e.excludeProviders))throw new a("Exclude providers must be an array");if(!e.excludeProviders.every(e=>"string"==typeof e))throw new a("All excluded providers must be strings")}if(e.requiredFeatures){if(!Array.isArray(e.requiredFeatures))throw new a("Required features must be an array");if(!e.requiredFeatures.every(e=>"string"==typeof e))throw new a("All required features must be strings")}!function(e){const t=["onReady","onProgress","onComplete","onError","onCancel"];for(const i of t){const t=e[i];if(void 0!==t&&"function"!=typeof t)throw new a(`${i} must be a function`)}}(e)}const h={apiUrl:"https://api.vecu.com/v1",environment:"production",theme:"auto",language:"en",autoRetry:!0,maxRetries:3,timeout:3e4,debug:!1,logLevel:"error"};class m{constructor(){this._isLoaded=!1,this.sdkInstance=null,this.activeUI=null,this.eventEmitter=new t,this.logger=new o("info",!0)}get isLoaded(){return this._isLoaded}mapEvent(e){if(!e||"object"!=typeof e)return null;const t=e;return{type:String(t.type||"unknown"),data:t.data||t,timestamp:new Date}}destroy(){this.activeUI&&(this.activeUI.destroy(),this.activeUI=null),this.sdkInstance&&(this.cleanupSDK(),this.sdkInstance=null),this.eventEmitter&&this.eventEmitter.removeAllListeners(),this._isLoaded=!1,this.logger.info(`${this.name} provider destroyed`)}async loadScript(e,t){return new Promise((i,s)=>{if(t&&window[t])return this.logger.info(`${this.name} SDK already loaded`),void i();const r=document.createElement("script");r.src=e,r.async=!0,r.crossOrigin="anonymous",r.onload=()=>{this.logger.info(`${this.name} SDK loaded successfully`),i()},r.onerror=t=>{this.logger.error(`Failed to load ${this.name} SDK`,t),s(new n("PROVIDER_SDK_LOAD_FAILED",`Failed to load ${this.name} SDK from ${e}`))},document.head.appendChild(r)})}createUIContainer(e,t){const i=document.createElement("div");return i.className=`vecu-idv-${this.name}-container vecu-idv-${t}`,i.setAttribute("data-provider",this.name),i.style.cssText=`\n      position: ${"modal"===t?"fixed":"relative"};\n      width: 100%;\n      height: 100%;\n      ${"modal"===t?"top: 0; left: 0; z-index: 9999;":""}\n    `,e.appendChild(i),i}removeUIContainer(e){e&&e.parentNode&&e.parentNode.removeChild(e)}emitProviderEvent(e,t){const i={type:e,data:t,timestamp:new Date};this.eventEmitter.emit(e,i),this.eventEmitter.emit("provider:event",i)}handleProviderError(e,t){const i=e instanceof n?e:new n("PROVIDER_ERROR",`${this.name} provider error in ${t}: ${e instanceof Error?e.message:String(e)}`,this.name);throw this.logger.error(`${this.name} provider error`,i),this.emitProviderEvent("provider:error",{code:i.code,message:i.message,provider:this.name,context:t}),i}on(e,t){this.eventEmitter.on(e,t)}off(e,t){this.eventEmitter.off(e,t)}validateInitOptions(e){if(!e.sessionId)throw new n("INVALID_OPTIONS","Session ID is required");if(!e.token)throw new n("INVALID_OPTIONS","Token is required");if(!(e.container&&e.container instanceof HTMLElement))throw new n("INVALID_OPTIONS","Valid HTML container element is required");if(!["modal","embedded"].includes(e.mode))throw new n("INVALID_OPTIONS",'Mode must be either "modal" or "embedded"')}}const f={socure:{scriptUrl:"https://websdk.socure.com/bundle.js",supportedFeatures:["document_verification","liveness_check","face_match","address_verification","database_check","qr_code_handoff"]}},p="ready",v="start",I="complete",g="error",E="close",D="document:front:capture",_="document:back:capture",w="document:processing",S="liveness:start",R="liveness:processing",y="liveness:complete";function O(e,t){return new Promise((i,s)=>{const r=function(e,t){const i=document.createElement(e);return t&&Object.entries(t).forEach(([e,t])=>{"className"===e?i.className=t:"style"===e?i.setAttribute("style",t):e.startsWith("data-")?i.setAttribute(e,t):i[e]=t}),i}("script",{src:e,async:"true",...t});r.onload=()=>i(),r.onerror=()=>s(new Error(`Failed to load script: ${e}`)),document.head.appendChild(r)})}class A{constructor(){this.loadPromise=null,this.sdkInstance=null}static getInstance(){return A.instance||(A.instance=new A),A.instance}async load(){if(this.sdkInstance)return this.sdkInstance;if(this.loadPromise)return this.loadPromise;this.loadPromise=this.loadSDK();try{return this.sdkInstance=await this.loadPromise,this.sdkInstance}catch(e){throw this.loadPromise=null,e}}async loadSDK(){const e=f.socure,t="SocureDocVSDK";if(window[t])return window[t];const i=3e4,s=new Promise((e,t)=>{setTimeout(()=>{t(new d("Socure SDK load timeout after 30000ms",i))},i)}),r=O(e.scriptUrl,{"data-provider":"socure",crossorigin:"anonymous"}).then(()=>{const e=window[t];if(!e)throw new Error(`Socure DocV SDK not found at window.${t}`);return e});return Promise.race([r,s])}isLoaded(){return null!==this.sdkInstance}getSDK(){return this.sdkInstance}destroy(){this.sdkInstance=null,this.loadPromise=null}}A.instance=null;class N{static mapEvent(e){if(!e||"object"!=typeof e)return null;const t=e.type;return{type:this.eventMap[t]||t,data:this.mapEventData(t,e.data),timestamp:new Date(e.timestamp||Date.now())}}static mapEventData(e,t){switch(e){case"complete":return this.mapCompleteData(t);case"error":return this.mapErrorData(t);case"document_front_capture":case"document_back_capture":return this.mapDocumentCaptureData(t);case"liveness_complete":return this.mapLivenessData(t);case"qr_code_displayed":return this.mapQRCodeData(t);default:return t}}static mapCompleteData(e){return e?{sessionId:e.referenceId,status:"completed",documentData:e.documentData?{type:e.documentData.type,number:e.documentData.documentNumber,issuingCountry:e.documentData.issuingCountry,expirationDate:e.documentData.expirationDate,firstName:e.documentData.firstName,lastName:e.documentData.lastName,dateOfBirth:e.documentData.dateOfBirth,address:e.documentData.address}:void 0,livenessData:e.livenessData?{passed:e.livenessData.passed,score:e.livenessData.score,confidence:e.livenessData.confidence}:void 0,fraudSignals:e.fraud?{overallRisk:this.mapRiskLevel(e.fraud.score),signals:e.fraud.signals.map(e=>({type:e.name,risk:e.risk,description:e.description}))}:void 0}:{}}static mapErrorData(e){return e?{code:e.code||"SOCURE_ERROR",message:e.message||"Socure verification error",details:e.details,provider:"socure"}:{code:"UNKNOWN_ERROR",message:"Unknown error occurred"}}static mapDocumentCaptureData(e){return{side:e?.side||"unknown",quality:e?.quality||"unknown",timestamp:(new Date).toISOString()}}static mapLivenessData(e){return{passed:e?.passed||!1,score:e?.score||0,confidence:e?.confidence||"low",timestamp:(new Date).toISOString()}}static mapQRCodeData(e){return{qrCodeUrl:e?.url,sessionUrl:e?.sessionUrl,expiresAt:e?.expiresAt}}static mapRiskLevel(e){return e<30?"low":e<70?"medium":"high"}static mapWebhookData(e){if(!e)return null;const t=e.documentVerification?.decision||e.selfieVerification?.decision||"review";return{sessionId:e.referenceId,provider:"socure",status:"complete"===e.status?"completed":"failed",decision:this.mapDecision(t),documentData:e.documentVerification?{type:e.documentVerification.documentType,...e.documentVerification.documentFields}:void 0,livenessData:e.selfieVerification?{passed:"accept"===e.selfieVerification.decision,score:e.selfieVerification.livenessScore,confidence:this.mapConfidence(e.selfieVerification.livenessScore)}:void 0,fraudSignals:e.fraud?{overallRisk:this.mapRiskLevel(e.fraud.score),signals:e.fraud.signals.map(e=>({type:e,risk:"medium",description:e}))}:void 0,completedAt:new Date(e.updatedAt)}}static mapDecision(e){switch(e){case"accept":return"approved";case"reject":return"declined";default:return"review"}}static mapConfidence(e){return e>=80?"high":e>=50?"medium":"low"}}N.eventMap={init:p,ready:p,start:v,document_front_capture:D,document_back_capture:_,document_processing:w,liveness_start:S,liveness_processing:R,liveness_complete:y,complete:I,error:g,close:E,qr_code_displayed:"qr_code:displayed",mobile_handoff:"mobile:handoff"};var T=Object.freeze({__proto__:null,SocureProvider:class extends m{constructor(){super(),this.name="socure",this.version="1.0.0",this.supportedFeatures=[...f.socure.supportedFeatures],this.socureDocVSDK=null,this.activeSession=null,this.sdkLoader=A.getInstance()}async loadSDK(){try{this.logger.info("Loading Socure DocV SDK..."),this.socureDocVSDK=await this.sdkLoader.load(),this._isLoaded=!0,this.logger.info("Socure DocV SDK loaded successfully"),this.emitProviderEvent("provider:loaded",{provider:this.name})}catch(e){this.handleProviderError(e,"loadSDK")}}async initializeVerification(e){try{if(this.validateInitOptions(e),!this.socureDocVSDK)throw new c(this.name,"Socure DocV SDK not loaded");this.logger.info("Initializing Socure verification",{sessionId:e.sessionId});const t=e.config?.publicKey||e.config?.sdkKey;if(!t)throw new c(this.name,"Socure SDK key is required in provider config");const i=e.token;if(!i)throw new c(this.name,"docvTransactionToken is required");const s=this.createUIContainer(e.container,e.mode),r={onProgress:t=>{this.logger.info("Socure progress event",t),this.handleProgressEvent(t,e.sessionId)},onSuccess:t=>{this.logger.info("Socure verification completed",t);const i=N.mapEvent({type:"complete",data:t,timestamp:Date.now()});i&&this.emitProviderEvent(i.type,i.data),this.emitProviderEvent("verification:completed",{sessionId:e.sessionId,result:t})},onError:t=>{this.logger.error("Socure verification error",t);const i=N.mapEvent({type:"error",data:t,timestamp:Date.now()});i&&this.emitProviderEvent(i.type,i.data),"USER_CANCELLED"===t.code&&this.emitProviderEvent("ui:closed",{sessionId:e.sessionId})},qrCodeNeeded:e.config?.qrCode||!1},o=s,n=this.socureDocVSDK.launch(t,i,o,r);this.activeSession=n&&"object"==typeof n?n:{id:e.sessionId,status:"active",destroy:()=>{this.logger.info("Destroying Socure session")}};const a={container:s,sessionId:e.sessionId,provider:this.name,destroy:()=>{this.destroySession(),this.removeUIContainer(s)}};return this.activeUI=a,this.emitProviderEvent("ui:created",{sessionId:e.sessionId}),setTimeout(()=>{this.emitProviderEvent("ui:ready",{sessionId:e.sessionId})},100),a}catch(e){this.handleProviderError(e,"initializeVerification")}}processWebhookData(e){try{const t=N.mapWebhookData(e);return{status:t.status,decision:t.decision,data:{documentData:t.documentData,livenessData:t.livenessData,fraudSignals:t.fraudSignals},metadata:{provider:this.name,processedAt:(new Date).toISOString()}}}catch(e){throw this.logger.error("Failed to process webhook data",e),new c(this.name,"Failed to process webhook data")}}mapEvent(e){return N.mapEvent(e)}cleanupSDK(){this.destroySession(),this.sdkLoader.destroy(),this.socureDocVSDK=null}handleProgressEvent(e,t){const i={type:{started:"verification:started",document_front_captured:"document_front_capture",document_back_captured:"document_back_capture",document_processing:"document_processing",liveness_started:"liveness_start",liveness_processing:"liveness_processing",liveness_complete:"liveness_complete",qr_code_displayed:"qr_code_displayed",mobile_handoff:"mobile_handoff"}[e.event]||e.event,data:e.data,timestamp:Date.now()},s=this.mapEvent(i);s&&this.emitProviderEvent(s.type,s.data),this.emitProviderEvent("verification:progress",{sessionId:t,step:e.event,percentage:this.calculateProgress(e.event),message:this.getProgressMessage(e.event)})}calculateProgress(e){return{started:10,document_front_captured:30,document_back_captured:50,document_processing:60,liveness_started:70,liveness_processing:85,liveness_complete:95,complete:100}[e]||0}getProgressMessage(e){return{started:"Starting verification...",document_front_captured:"Document front captured",document_back_captured:"Document back captured",document_processing:"Processing documents...",liveness_started:"Starting liveness check...",liveness_processing:"Processing liveness check...",liveness_complete:"Liveness check complete",complete:"Verification complete"}[e]||e}destroySession(){if(this.activeSession){try{this.activeSession.destroy()}catch(e){this.logger.error("Error destroying Socure session",e)}this.activeSession=null}}}});e.ConfigurationError=class extends n{constructor(e,t){super("CONFIGURATION_ERROR",e,void 0,t),this.name="ConfigurationError"}},e.EVENTS={SDK_INIT:"sdk:init",SDK_READY:"sdk:ready",SDK_ERROR:"sdk:error",SDK_DESTROY:"sdk:destroy",PROVIDER_LOADED:"provider:loaded",PROVIDER_READY:"provider:ready",PROVIDER_ERROR:"provider:error",PROVIDER_EVENT:"provider:event",VERIFICATION_CREATED:"verification:created",VERIFICATION_STARTED:"verification:started",VERIFICATION_PROGRESS:"verification:progress",VERIFICATION_COMPLETED:"verification:completed",VERIFICATION_FAILED:"verification:failed",VERIFICATION_CANCELLED:"verification:cancelled",VERIFICATION_EXPIRED:"verification:expired",UI_CREATED:"ui:created",UI_READY:"ui:ready",UI_ERROR:"ui:error",UI_CLOSED:"ui:closed",UI_DESTROYED:"ui:destroyed"},e.ErrorCodes={INVALID_API_KEY:"INVALID_API_KEY",MISSING_CONFIG:"MISSING_CONFIG",INVALID_CONFIG:"INVALID_CONFIG",SDK_NOT_INITIALIZED:"SDK_NOT_INITIALIZED",SDK_INIT_FAILED:"SDK_INIT_FAILED",SDK_ALREADY_INITIALIZED:"SDK_ALREADY_INITIALIZED",PROVIDER_NOT_FOUND:"PROVIDER_NOT_FOUND",PROVIDER_LOAD_FAILED:"PROVIDER_LOAD_FAILED",PROVIDER_SDK_LOAD_FAILED:"PROVIDER_SDK_LOAD_FAILED",PROVIDER_INIT_FAILED:"PROVIDER_INIT_FAILED",PROVIDER_NOT_SUPPORTED:"PROVIDER_NOT_SUPPORTED",SESSION_NOT_FOUND:"SESSION_NOT_FOUND",SESSION_EXPIRED:"SESSION_EXPIRED",SESSION_CREATE_FAILED:"SESSION_CREATE_FAILED",SESSION_ALREADY_EXISTS:"SESSION_ALREADY_EXISTS",VERIFICATION_FAILED:"VERIFICATION_FAILED",VERIFICATION_CANCELLED:"VERIFICATION_CANCELLED",VERIFICATION_TIMEOUT:"VERIFICATION_TIMEOUT",INVALID_CONTAINER:"INVALID_CONTAINER",UI_INIT_FAILED:"UI_INIT_FAILED",UI_DESTROYED:"UI_DESTROYED",NETWORK_ERROR:"NETWORK_ERROR",TIMEOUT_ERROR:"TIMEOUT_ERROR",API_ERROR:"API_ERROR",INVALID_OPTIONS:"INVALID_OPTIONS",INVALID_USER_DATA:"INVALID_USER_DATA",MISSING_REQUIRED_FIELD:"MISSING_REQUIRED_FIELD"},e.EventEmitter=t,e.Logger=o,e.NetworkError=class extends n{constructor(e,t){super("NETWORK_ERROR",e,void 0,t),this.name="NetworkError"}},e.PROVIDER_FEATURES={DOCUMENT_VERIFICATION:"document_verification",LIVENESS_CHECK:"liveness_check",FACE_MATCH:"face_match",ADDRESS_VERIFICATION:"address_verification",DATABASE_CHECK:"database_check",PHONE_VERIFICATION:"phone_verification",EMAIL_VERIFICATION:"email_verification",QR_CODE_HANDOFF:"qr_code_handoff",VIDEO_VERIFICATION:"video_verification"},e.ProviderError=c,e.SDK_NAME="@vecu-idv-web-sdk",e.SDK_VERSION="1.0.0",e.SUPPORTED_PROVIDERS=["socure","incode","jumio","onfido","veriff"],e.SessionError=class extends n{constructor(e,t){super("SESSION_ERROR",e,void 0,{sessionId:t}),this.name="SessionError"}},e.TimeoutError=d,e.ValidationError=a,e.VecuError=n,e.VecuIDV=class{constructor(e){this.initialized=!1,l(e),this.config={...h,...e},this.eventEmitter=new t,this.logger=new o(this.config.logLevel,this.config.debug),this.providerRegistry=new s,this.providerLoader=new r(this.providerRegistry),this.activeSessions=new Map;const n={baseUrl:this.config.apiUrl,apiKey:this.config.apiKey,timeout:this.config.timeout,maxRetries:this.config.maxRetries,retryDelay:1e3};this.apiClient=new i(n),this.logger.info("VecuIDV SDK initialized")}async init(){if(this.initialized)this.logger.warn("SDK already initialized");else try{this.eventEmitter.emit("sdk:init");const e=await this.apiClient.createVerificationSession({test:!0});if(!e.success)throw new n("SDK_INIT_FAILED",`Failed to initialize SDK: ${e.error?.message}`);this.initialized=!0,this.eventEmitter.emit("sdk:ready"),this.logger.info("SDK initialized successfully")}catch(e){throw this.logger.error("Failed to initialize SDK",e),this.eventEmitter.emit("sdk:error",{code:"SDK_INIT_FAILED",message:e instanceof Error?e.message:"Unknown error",details:e}),e}}async createVerification(e){if(!this.initialized)throw new n("SDK_NOT_INITIALIZED","SDK must be initialized before creating verification");try{u(e),this.logger.info("Creating verification session",{options:e});const t=await this.apiClient.createVerificationSession({userData:e.user,preferredProvider:e.preferredProvider,excludeProviders:e.excludeProviders,requiredFeatures:e.requiredFeatures,metadata:e.metadata});if(!t.success||!t.data)throw new n("SESSION_CREATE_FAILED",t.error?.message||"Failed to create verification session");const i=t.data;this.activeSessions.set(i.id,i);const s=await this.providerLoader.load(i.provider);this.setupVerificationEventHandlers(i.id,e);const r=this.resolveContainer(e.container),o=await s.initializeVerification({sessionId:i.id,token:i.providerSessionId||"",container:r,mode:e.mode||"embedded",theme:this.config.theme,language:this.config.language,userData:e.user,config:e.providerConfig});return this.eventEmitter.emit("verification:created",{session:i,ui:o}),this.logger.info("Verification session created",{sessionId:i.id}),i}catch(e){throw this.logger.error("Failed to create verification",e),this.eventEmitter.emit("verification:failed",{error:e instanceof Error?e.message:"Unknown error"}),e}}async getVerificationStatus(e){const t=await this.apiClient.getVerificationSession(e);if(!t.success||!t.data)throw new n("SESSION_NOT_FOUND",`Verification session ${e} not found`);return t.data.status}async getVerificationResult(e){const t=await this.apiClient.getVerificationResult(e);if(!t.success||!t.data)throw new n("RESULT_NOT_FOUND",`Verification result for session ${e} not found`);return t.data}async cancelVerification(e){if(!this.activeSessions.get(e))throw new n("SESSION_NOT_FOUND",`Active session ${e} not found`);await this.apiClient.cancelVerification(e),this.activeSessions.delete(e),this.eventEmitter.emit("verification:cancelled",{sessionId:e})}on(e,t){this.eventEmitter.on(e,t)}off(e,t){this.eventEmitter.off(e,t)}once(e,t){this.eventEmitter.once(e,t)}getAvailableProviders(){return this.providerRegistry.getAll()}getProvider(e){return this.providerRegistry.get(e)||null}destroy(){this.activeSessions.forEach(e=>{this.cancelVerification(e.id).catch(t=>{this.logger.error(`Failed to cancel session ${e.id}`,t)})}),this.providerRegistry.clear(),this.eventEmitter.removeAllListeners(),this.initialized=!1,this.eventEmitter.emit("sdk:destroy"),this.logger.info("SDK destroyed")}resolveContainer(e){if(!e){const e=document.createElement("div");return e.id="vecu-idv-container",document.body.appendChild(e),e}if("string"==typeof e){const t=document.querySelector(e);if(!(t&&t instanceof HTMLElement))throw new n("INVALID_CONTAINER",`Container element '${e}' not found`);return t}return e}setupVerificationEventHandlers(e,t){t.onReady&&this.eventEmitter.once("ui:ready",t.onReady),t.onProgress&&this.eventEmitter.on("verification:progress",i=>{if(i.data&&"object"==typeof i.data&&"sessionId"in i.data){const s=i.data;s.sessionId===e&&t.onProgress({step:s.step,percentage:s.percentage,message:s.message})}}),t.onComplete&&this.eventEmitter.once("verification:completed",async i=>{if(i.data&&"object"==typeof i.data&&"sessionId"in i.data){if(i.data.sessionId===e){const i=await this.getVerificationResult(e);t.onComplete(i)}}}),t.onError&&this.eventEmitter.on("verification:failed",i=>{if(i.data&&"object"==typeof i.data&&"sessionId"in i.data){const s=i.data;s.sessionId===e&&t.onError(new Error(s.error))}}),t.onCancel&&this.eventEmitter.once("verification:cancelled",i=>{if(i.data&&"object"==typeof i.data&&"sessionId"in i.data){i.data.sessionId===e&&t.onCancel()}})}}});
//# sourceMappingURL=index.umd.js.map
